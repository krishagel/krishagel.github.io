---
layout: post
title: Etherpad Open Source Installation Step-By-Step
date: '2010-04-02T10:09:00.000-07:00'
author: Kris Hagel
tags:
- Documentation Etherpad
modified_time: '2010-04-02T10:11:09.528-07:00'
thumbnail: http://3.bp.blogspot.com/_BBmDIqRhYWw/S7YW4YqFhZI/AAAAAAAAA0Y/7wyvVy9lW10/s72-c/Screen+shot+2010-04-02+at+9.03.43+AM.png
blogger_id: tag:blogger.com,1999:blog-3730747668829960203.post-4324629799258335591
blogger_orig_url: http://blog.krishagel.com/2010/04/etherpad-open-source-installation-step.html
---

Today I wanted to create a blog post documenting the steps necessary to create a Etherpad virtual machine in our organization. &nbsp;This should work great for anyone else as well. &nbsp;This article is a mix of instructions from Ubuntu documentations found <a bitly="BITLY_PROCESSED" href="https://help.ubuntu.com/community/JeOS">here</a> and&nbsp;<a bitly="BITLY_PROCESSED" href="https://wiki.ubuntu.com/Etherpad">here</a>. &nbsp;This Etherpad virtual machine was also built on VMware vSphere 4.0, so there are a couple of steps specific to that environment, but in previous testing, I know that the same process works just fine in VMware Fusion as well.<br /><b><br /></b><br /><b>Virtual Machine Setup:</b><br /><br />First thing to do is to create a new virtual machine and installing the OS. &nbsp;We will be using Ubuntu 9.10 server and using the minimal virtual machine installation. &nbsp;You can see in the picture below how you can get this installation option, it is under the modes section you can access by hitting F4.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a bitly="BITLY_PROCESSED" href="http://3.bp.blogspot.com/_BBmDIqRhYWw/S7YW4YqFhZI/AAAAAAAAA0Y/7wyvVy9lW10/s1600-h/Screen+shot+2010-04-02+at+9.03.43+AM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="298" src="http://3.bp.blogspot.com/_BBmDIqRhYWw/S7YW4YqFhZI/AAAAAAAAA0Y/7wyvVy9lW10/s400/Screen+shot+2010-04-02+at+9.03.43+AM.png" width="400" /></a></div><br />Once you work through the installation of the OS which I won't go through here, you will be left with a very minimal Linux installation that we will then want to get brought up-to-date for the rest of the install.<br /><br />Once you log in for the first time, you will want to make sure the system is up-to-date. &nbsp;This is very important especially on ESX because there is a bug in the default Kernel that will not let you mount CD's which is necessary to install the VMware Tools. &nbsp;The commands for doing this are below:<br /><code><br />$ sudo apt-get update<br />$ sudo apt-get upgrade<br /></code><br /><br />This should get you the latest versions of everything installed by default.<br /><br />You will then need to install three sets of packages that are required for the installation of VMware Tools.<br /><code><br />$ sudo apt-get install&nbsp;build-essential linux-headers-$(uname -r) psmisc<br /></code><br /><br />Once these are installed, then you can ask VMware to install the tools, and you will complete the install by issuing the following steps.<br /><span class="Apple-style-span" style="font-family: monospace;"><span class="Apple-style-span" style="font-family: Times;"><br /></span></span><br /><code> $ mount /media/cdrom0<br />$ cd /tmp<br />$ tar xvzf /media/cdrom0/VMwareTools*.gz<br />$ sudo vmware-tools-distrib/vmware-install.pl -d<br />$ rm -rf vmware-tools-distrib<br />$ umount /media/cdrom0<br /></code><br /><br />Once this has been done, I always install a couple of other packages to make it easier to administer the server. &nbsp;These are optional, but I will keep them in the documentation in case you are interested.<br /><span class="Apple-style-span" style="font-family: monospace;"><span class="Apple-style-span" style="font-family: Times;"><br /></span></span><br /><code> $ sudo apt-get install openssh-server nano<br /></code><br /><div><br />This concludes the basic setup of the Virtual Machine. &nbsp;Now we can move on to the specifics of setting up Etherpad on this machine.<br /><br /></div><div><b>Etherpad Installation:</b></div><div><br /></div><div>The next thing we need to do for the process of install Etherpad is to install the dependencies that are required for this to run. &nbsp;We will do that with the following command:</div><div><code><br />$ sudo apt-get install sun-java6-jdk scala mysql-server mysql-client libmysql-java mercurial<br /></code></div><div><br /></div><div>One thing to be careful of is that when you install the mysql server it is going to ask you for a password for the root user. &nbsp;Make sure that you write this down or remember it so we can use it later in the process.</div><div><br /></div><div>Next you will want to download the source code from Google. &nbsp;I prefer to put all of this code in the /opt directory on your server, but I have been known to use the /tmp directory as well.</div><div><br /></div><div>The following lines will get you all the source code necessary.</div><div><br /></div><div><code>$ cd /opt<br />$ hg clone http://etherpad.googlecode.com/hg/ etherpad<br /></code></div><div><br /></div><div>You will then need to make some changes to this source code to get it to compile on Ubuntu, but I will try and simplify that as much as possible.</div><div><br /></div><div>The first file you will need to modify is titled makejar.sh which can be found in /opt/etherpad/trunk/infrastructure/bin. &nbsp;You will want to modify the file to make changes to two specific lines. &nbsp;You can use the command below to open the file for editing.</div><div><code><br />$ sudo nano /opt/etherpad/trunk/infrastructure/bin/makejar.sh<br /></code></div><div><br /></div><div>On Line 35 of makejar.sh, you will want to change this:</div><div><code><br />JARFILES=`echo $SCALA_HOME/lib/scala-library.jar lib/*.jar lib/manifest`<br /></code></div><div><br /></div><div>Into this:</div><div><code><br />JARFILES=`echo $SCALA_HOME/scala-library.jar lib/*.jar lib/manifest`<br /></code></div><div><br /></div><div>Also, on line 39 you will want to change this:</div><div><code><br />$JAR xf $SCALA_HOME/lib/scala-library.jar<br /></code></div><div><br /></div><div>Into this:</div><div><code><br />$JAR xf $SCALA_HOME/scala-library.jar<br /></code></div><div><br /></div><div>You will see that in both cases you are strictly removing the /lib directory out of the path.</div><div><br /></div><div>By using ctrl-o and ctrl-x in nano you will be able to save and close.<br /><br />You will then need to add your server to /opt/etherpad/trunk/etherpad/src/etherpad/globals.js<br /><br /><code>$ sudo nano /opt/etherpad/trunk/etherpad/src/etherpad/globals.js</code><br /><br />On line 30, you will want to add a couple of lines: (Of course changing server.dns.name and server.ip.address to match the name and ip address in your environment)<br /><code><br />'server.dns.name': true,<br />'server.ip.address': true,<br /></code><br /><div><br /></div><div>Again, ctrl-o ctrl-x to save your changes. &nbsp;</div><div><br /></div><div>You will now need to set a bunch of environment variables to make sure the code will compile correctly.</div><div><br /></div><div><div><code>$ export JAVA_HOME=/usr/lib/jvm/java-6-sun</code></div><div><code>$ export JAVA="$JAVA_HOME/bin/java"</code></div><div><code>$ export SCALA_HOME=/usr/share/java &nbsp; &nbsp;# or =/tmp – see above</code></div><div><code>$ export SCALA="$SCALA_HOME/bin/scala" # Shouldn’t it be =/usr/bin/scala ?</code></div><div><code>$ export PATH="$JAVA_HOME/bin:$SCALA_HOME/bin:$PATH"</code></div><div><code>$ export MYSQL_CONNECTOR_JAR=/usr/share/java/mysql-connector-java.jar</code></div></div><div><br /></div><div>You have two more files to make changes to, and then we can run the compile and start the application. &nbsp;For this modification, we need to make a couple of setup changes to the database script so that it will work correctly with your password you setup earlier.</div><div><br /></div><div><code>$ sudo nano /opt/etherpad/trunk/etherpad/bin/setup-mysql-db.sh</code></div><div><br /></div><div>On line 22, add the following line:</div><div><br /></div><div><code>mysql="mysql"</code></div><div><br /></div><div>Then on line 26, change:</div><div><br /></div><div><code>echo "create database ${db};" | ${mysql} -u root</code></div><div><br /></div><div>To this:&nbsp;(yourpass should be what you setup earlier)</div><div><br /></div><div><code>echo "create database ${db};" | ${mysql} --user=root --password=yourpass</code></div><div><br /></div><div>Also, change line 29 from this:</div><div><br /></div><div><code>echo "grant all privileges on ${db}.* to 'etherpad'@'localhost' identified by 'password';" | ${mysql} -u root</code></div><div><br /></div><div>To this: (again, yourpass should be what you setup earlier)</div><div><br /></div><div><code>echo "grant all privileges on ${db}.* to 'etherpad'@'localhost' identified by 'password';" | ${mysql} --user=root --password=etherpad</code></div><div><br /></div><div>Save the file with ctrl-o ctrl-x and then run it</div><div><br /></div><div><div><code>$ cd /opt/etherpad/trunk/etherpad</code></div><div><code>$ sudo bin/setup-mysql-db.sh</code></div></div><div><br /></div><div>You will want to make one final change, and that is to change the default port to port 80 instead of port 9000 which is what is in the code by default.</div><div><br /></div><div><code>$ sudo nano /opt/etherpad/trunk/etherpad/etc/etherpad.localdev-default.properties</code></div><div><br /></div><div>On line 11, change the listen port from 9000 to 80 so it looks like this:</div><div><br /></div><div><code>listen = 80</code></div><div><br /></div><div>Once you save the file, you can then build the application:</div><div><br /></div><div><code>$ cd /opt/etherpad/trunk/etherpad</code></div><div><code>$ bin/rebuildjar.sh</code></div><div><br /></div><div>Once that completes, you can start the application:</div><div><br /></div><div><code>$ bin/run-local.sh</code></div><div><br /></div><div>That is it, if everything worked out correctly you should see the following screen:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a bitly="BITLY_PROCESSED" href="http://4.bp.blogspot.com/_BBmDIqRhYWw/S7Yie6-u6gI/AAAAAAAAA0c/W05ycwYddvA/s1600-h/Screen+shot+2010-04-02+at+9.59.00+AM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="220" src="http://4.bp.blogspot.com/_BBmDIqRhYWw/S7Yie6-u6gI/AAAAAAAAA0c/W05ycwYddvA/s400/Screen+shot+2010-04-02+at+9.59.00+AM.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">Clicking on the big button will get you the interface you may have been accustomed to:</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a bitly="BITLY_PROCESSED" href="http://2.bp.blogspot.com/_BBmDIqRhYWw/S7YipznucxI/AAAAAAAAA0g/7Ken9cMnOno/s1600-h/Screen+shot+2010-04-02+at+9.59.12+AM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="282" src="http://2.bp.blogspot.com/_BBmDIqRhYWw/S7YipznucxI/AAAAAAAAA0g/7Ken9cMnOno/s400/Screen+shot+2010-04-02+at+9.59.12+AM.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div>If you have any problems, or questions about this, please feel free to let me know.</div></div>