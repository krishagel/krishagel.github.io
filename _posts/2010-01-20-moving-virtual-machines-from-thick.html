---
layout: post
title: Errors Moving Virtual Machines From Thick Provisioned To Thin Provisioned in
  Vsphere 4.0
date: '2010-01-20T20:20:00.000-08:00'
author: Kris Hagel
tags:
- vSphere
- Howto
modified_time: '2010-01-20T20:49:28.459-08:00'
thumbnail: http://3.bp.blogspot.com/_BBmDIqRhYWw/S1faWz_SCvI/AAAAAAAAAz0/pB3aTVYol_k/s72-c/storageVmotionError.png
blogger_id: tag:blogger.com,1999:blog-3730747668829960203.post-5265609420811404128
blogger_orig_url: http://blog.krishagel.com/2010/01/moving-virtual-machines-from-thick.html
---

So, as a part of my plan to try and blog more in 2010, and also to try and document more of what I am doing for my own reference as well, I present you with the following article...<br /><br />Over the last couple of months I have been trying to come up with ways that we could reclaim some of the space on our Equallogic SAN that is quickly being used up.  One of the obvious options is to move some of our virtual machines that were created in the ESX 3.5 days where the option to thin provision wasn't available to the new thin provisioned format supported in vSphere 4.0.<br /><br />Before this week I had tried before to perform a storage vmotion to change from thick to thin provisioned but had always just tried to keep it on the same datastore.  In listening to the <a href="http://blogs.vmware.com/vmtn/podcasts/">VMware Communities Podcast</a> over the past year I have caught onto many hints and tips that have lead me to new ideas, and this same thing happened about a week ago.  They were discussing something about performing storage vmotions between datastores to change formats and I thought wow, I need to try that and see if it would work.<br /><br />Of course this did exactly what I wanted, shrinking the actual usage of disk space on my SAN.  This process is not without minor issues though, and that really is the purpose of this blog post.  Once I had moved the machine from one datastore to another and changed to thin provisioned format, I was getting errors that would not allow the machine to be moved back to its original datastore:<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_BBmDIqRhYWw/S1faWz_SCvI/AAAAAAAAAz0/pB3aTVYol_k/s1600-h/storageVmotionError.png"><img style="margin: 0px auto 10px; display: block; text-align: center; cursor: pointer; width: 400px; height: 324px;" src="http://3.bp.blogspot.com/_BBmDIqRhYWw/S1faWz_SCvI/AAAAAAAAAz0/pB3aTVYol_k/s400/storageVmotionError.png" alt="" id="BLOGGER_PHOTO_ID_5429047961266031346" border="0" /></a><br />These errors shown here: "A general system error occured: The virtual machine has virtual disk in link-cloned mode that prevents migration" lead me to find the following <a href="http://kb.vmware.com/selfservice/microsites/search.do?cmd=displayKC&amp;docType=kc&amp;externalId=1014249&amp;sliceId=1&amp;docTypeID=DT_KB_1_1&amp;dialogID=62899014&amp;stateId=0%200%2062897527">KB article</a> at VMware which gives four options to solve the issue.<br /><br />I took the path that seemed easiest to me, and that was to vmotion the machine to another host.  Of course, as expected this solution solved the problem, and I was able to then migrate the machine back to its original datastore, but now in thin provisioned mode.  All in all, I migrated 8 machines, and this resulted in a gain of approx. 700gb of usable disk space reclaimed which will definitely help us as we move forward in the future.